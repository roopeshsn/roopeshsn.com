---
title: PTP
createdAt: 2025-09-20
updatedAt: 2025-00-20
category: time, ptp
summary: This note discusses about PTP
tags: time, ptp
author: Roopesh Saravanan
image: none
---

This byte emphazies more math part involved in PTP algorithm. It also miss some parts of PTP like BMCA.

Every computer systems have Real Time Clock (RTC) in the motherboard. If the initial time is set, it keeps ticking even when the system is powered off. The component that keeps tracking of time is called Quartz Crystal Oscillator. It works by Inverse Piezo Electric effect. This crystal material will be placed between two metal plates and When a voltage, typically Biasing voltage (Vcc) is introduced to an oscillator circuit, the crystal will start vibrates at its natural frequency. This vibration will be sensed by the amplifier in the oscillator circuit and fed back to the crystal again. Here's where the time calculation kicks in.

A crystal material osciallates or vibrates 32,768 times per second. So the frequency of the crystal material is 32,768 Hz.

```
frequency = number of cycles / second
```

In the Oscillator circuit we have 15 flip flops connected in series to divide 32,768. Each flip flop will divide the input value by 2. So the 15th flip flop should get a quotient of 1 to conclude that the crystal material exhibited a frequency of 32,768 Hz. The flip flops acts a counter here.

The drawback of using RTC is that we don't have any global reference. In a network two systems which is geographically separated and in different timezones should need to have the time reference to timestamp packets.

For instance consider a trading network. If a exchange receives two orders (two packets) for the same asset instrument, it needs pick the one which is arrived first. Often difference will be nanoseconds. This is one application of having same time reference between the systems (servers, switches, and more) to timestamp the packets. 

To solve the time reference problem, NTP and PTP were introduced. 

In NTP, every devices in the network will sync the time from one device. That one device sync time from accurate clocks like GPS receiver, Atomic clock etc.

## PTP

In a network as packets are bridged and routed by the intermediate devices there is a time associated with each bridging and routing operations. NTP won't take that switching time in to account. This is solved by PTP.

In short, PTP aware devices uses a mechanism to calculate the delay time for the PTP packets that is received from its peer. This delay time will be adjusted to maintain the system clock.

If A tells 8 AM but when it's reaching B it is 8:01 AM then 

Say there are two devices A and B. Let's assume B is syncing time from A using PTP. The objective is that B should calculate both delay and the offset.

There are two values we need to find Delay and Offset. 
Delay: Time taken in the path
Offset: Time difference between two devices when a message is received.

Below is the simplified version of PTP offset and delay calculation algorithm.
- A sends two messages to B, Sync and Follow-up. 
- Sync Message contains the current time of A. As the PTP packets are generated by the Software, A doesn't know when the Sync packet is sent on the wire.
- The Hardware capture the sent timestamp and communicates it to the Software. A now send this time in the Follow up packet.
- B records the time when it receive Sync and Followup messages from A.

The time that A sends in followup message it t1 and the time that B records it is taken a t2.

```
Offset from A = (t2 - t1) - delay
```

The final block:
1. B will shoot out Delay Request packet. The time when B sends will be marked as t3. This is like B is asking A to send the time upon receiving it's packet.
2. A will send Delay Respone upon receiving Delay Request packet from B. This is taken as t4.

```

```

A Grandmaster (GM) clock sync time from the GPS and 

Message Intervals:

Sync Message interval is 2^-3, which is 0.125s (8 messages per second)
Announce Message interval is 2^0, which is 1s (1 message per second)
Delay Request Message interval is 2^-3 which is 0.125s (8 messages per second)






